<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración</title>

    <script src="https://kit.fontawesome.com/d11b1428bd.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/styles.css">

    <!-- Agrega tu script de administración -->
    <script src="../static/admin-script.js"></script>
</head>

<body>
    <nav>
        <!-- ... Tu código de navegación ... -->
    </nav>

    <div id="admin-lista-registros">
        <!-- Aquí se mostrará la lista de registros -->
    </div>

    <div id="admin-formulario">
        <!-- Aquí se encuentra el formulario para modificar registros -->
        <form id="modificarForm">
            <label for="dni">DNI:</label>
            <input type="text" name="dni" placeholder="Ingrese el DNI" required>
            <label for="direccion">Nueva Dirección:</label>
            <input type="text" name="direccion" placeholder="Ingrese la nueva dirección">
            <label for="ciudad">Nueva Ciudad:</label>
            <input type="text" name="ciudad" placeholder="Ingrese la nueva ciudad">
            <label for="cp">Nuevo CP:</label>
            <input type="text" name="cp" placeholder="Ingrese el nuevo CP">
            <input type="submit" value="Modificar">
        </form>
    </div>

    
    <!-- ... Otro contenido HTML ... -->

    <footer>
        <!-- ... Tu código de pie de página ... -->
    </footer>

    <script>
        $(document).ready(function () {
            // Al cargar la página, cargar la lista de registros
            listar_clientes();

            // Evento para manejar la modificación de un cliente
            $("#modificarForm").submit(function (event) {
                event.preventDefault();
                modificar_cliente();
            });

            
        });

        function cargarListaClientes() {
            // Llamada a la API para obtener la lista de clientes
            $.get("/clientes", function (data) {
                // Actualizar el contenido del contenedor de la lista de clientes
                $("#admin-lista-registros").html(generarListaHTML(data.clientes));
            });
        }

        function modificarCliente() {
            // Obtener datos del formulario de modificación
            const formData = $("#modificarForm").serialize();

            // Llamada a la API para modificar el cliente
            $.ajax({
                type: "PUT",
                url: `/clientes/${formData.dni}`,
                data: formData,
                success: function (data) {
                    // Actualizar la lista después de modificar el cliente
                    listar_clientes();

                    // Limpiar el formulario después de la modificación
                    $("#modificarForm")[0].reset();

                    console.log(data.mensaje);
                },
                error: function (error) {
                    console.error("Error al modificar el cliente:", error);
                }
            });
        }

        
        

        function generarListaHTML(clientes) {
            // Generar el HTML para mostrar la lista de clientes
            let html = "<ul>";

            clientes.forEach(cliente => {
                html += `<li>${cliente.nombre} ${cliente.apellido}</li>`;
            });

            html += "</ul>";

            return html;
        }
    </script>
</body>

</html>
